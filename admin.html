<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel â€” Rotate ON/OFF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body{font-family:Arial,sans-serif;background:#f6f7f9;padding:24px;max-width:800px;margin:auto;}
    h2{margin:0 0 12px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin-top:12px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border-bottom:1px solid #eee;padding:10px;text-align:left;font-size:14px}
    th{background:#fafafa}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:700px){.row{grid-template-columns:1fr}}
    button{cursor:pointer;border:0;background:#111;color:#fff;border-radius:10px;padding:10px 14px}
    .muted{color:#666;font-size:13px}
    .switch{position:relative;display:inline-block;width:46px;height:26px}
    .switch input{display:none}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.2s;border-radius:999px}
    .slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background:white;transition:.2s;border-radius:50%}
    input:checked + .slider{background:#0a7c2f}
    input:checked + .slider:before{transform:translateX(20px)}
    .status{margin-top:10px;font-size:14px}
  </style>
</head>
<body>
  <h2>Admin Panel â€” Rotate ON/OFF</h2>
  <p class="muted">Panel ini memuat <code>settings.json</code>, benarkan anda ON/OFF admin, dan muat turun fail tetapan untuk upload semula ke GitHub.</p>

  <div class="card">
    <div class="row">
      <div>
        <label>Mode:</label>
        <select id="modeSel">
          <option value="rotate">Rotate</option>
          <option value="schedule">Schedule</option>
        </select>
      </div>
      <div>
        <label>&nbsp;</label>
        <button id="refreshBtn">ðŸ”„ Reload settings.json</button>
      </div>
    </div>

    <table>
      <thead>
        <tr><th>#</th><th>Nama</th><th>Link</th><th>Aktif</th></tr>
      </thead>
      <tbody id="adminTbody"></tbody>
    </table>

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="downloadBtn">ðŸ’¾ Download settings.json</button>
    </div>

    <div id="status" class="status"></div>
  </div>

  <script>
    let settings = { mode:"rotate", rotationAdmins:[], timeSlots:[] };

    const modeSel     = document.getElementById('modeSel');
    const adminTbody  = document.getElementById('adminTbody');
    const refreshBtn  = document.getElementById('refreshBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const statusEl    = document.getElementById('status');

    async function loadSettings(){
      statusEl.textContent = "Memuat settings.json...";
      try{
        const res = await fetch('settings.json?_=' + Date.now());
        if(!res.ok) throw new Error('Gagal load settings.json');
        settings = await res.json();
        if(!Array.isArray(settings.rotationAdmins)) settings.rotationAdmins = [];
        if(!Array.isArray(settings.timeSlots)) settings.timeSlots = [];
        modeSel.value = settings.mode || 'rotate';
        renderAdmins();
        statusEl.textContent = "Settings dimuat.";
      }catch(e){
        statusEl.textContent = "âŒ Tidak dapat memuat settings.json";
        console.error(e);
      }
    }

    function renderAdmins(){
      adminTbody.innerHTML = '';
      settings.rotationAdmins.forEach((adm, i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td><input type="text" value="${adm.name || ''}" data-idx="${i}" data-field="name" style="width:100%"></td>
          <td><input type="text" value="${adm.link || ''}" data-idx="${i}" data-field="link" style="width:100%"></td>
          <td>
            <label class="switch">
              <input type="checkbox" ${adm.active ? 'checked' : ''} data-idx="${i}" data-field="active">
              <span class="slider"></span>
            </label>
          </td>
        `;
        adminTbody.appendChild(tr);
      });

      // bind changes
      adminTbody.querySelectorAll('input[type="text"]').forEach(inp=>{
        inp.addEventListener('input', (e)=>{
          const idx = parseInt(e.target.dataset.idx,10);
          const field = e.target.dataset.field;
          settings.rotationAdmins[idx][field] = e.target.value;
        });
      });
      adminTbody.querySelectorAll('input[type="checkbox"]').forEach(inp=>{
        inp.addEventListener('change', (e)=>{
          const idx = parseInt(e.target.dataset.idx,10);
          settings.rotationAdmins[idx].active = e.target.checked;
        });
      });
    }

    modeSel.addEventListener('change', ()=>{
      settings.mode = modeSel.value;
    });

    refreshBtn.addEventListener('click', loadSettings);

    downloadBtn.addEventListener('click', ()=>{
      // siapkan blob untuk download
      const blob = new Blob([JSON.stringify(settings, null, 2)], {type:'application/json'});
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href = url;
      a.download = 'settings.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      statusEl.textContent = "âœ… settings.json dimuat turun. Sila upload/replace ke GitHub Pages repo anda.";
    });

    // boot
    loadSettings();
  </script>
</body>
</html>
